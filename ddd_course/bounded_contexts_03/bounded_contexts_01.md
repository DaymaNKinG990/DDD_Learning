# Ограниченные контексты (Bounded Contexts)

## Введение

Ограниченные контексты (Bounded Contexts) — это ключевая концепция DDD, которая помогает справляться со сложностью больших систем, разделяя их на логически изолированные части. Каждый ограниченный контекст имеет свою собственную модель и свой универсальный язык.

## Основные концепции

### 1. Что такое ограниченный контекст?

Ограниченный контекст — это явная граница, внутри которой действует конкретная модель предметной области. За пределами этой границы те же термины могут иметь другое значение.

**Пример:**
- В контексте "Продажи" термин "Клиент" может включать историю покупок
- В контексте "Доставка" термин "Клиент" может включать только адрес доставки и контактные данные

### 2. Карта контекстов (Context Map)

Карта контекстов показывает, как различные ограниченные контексты взаимодействуют между собой. Это важный инструмент для понимания общей архитектуры системы.

**Типы отношений между контекстами:**
- **Партнерство (Partnership)** — два контекста тесно сотрудничают
- **Общий заказчик (Shared Kernel)** — общая подмодель, используемая несколькими контекстами
- **Заказчик-Поставщик (Customer-Supplier)** — один контекст поставляет данные другому
- **Согласованность (Conformist)** — один контекст следует модели другого без изменений
- **Антикоррупционный слой (Anticorruption Layer)** — слой, который преобразует данные из одного контекста в другой
- **Открытый сервис (Open Host Service)** — стандартизированный протокол для доступа к сервису
- **Разделяемый язык (Published Language)** — общий язык для общения между контекстами

### 3. Выявление границ контекстов

**Признаки для выделения контекста:**
- Разные команды разработчиков
- Разные бизнес-процессы
- Разные модели данных
- Разные уровни производительности и масштабируемости
- Разные циклы выпуска версий

## Практические аспекты

### 1. Проектирование ограниченных контекстов

**Шаги проектирования:**
1. Выявить основные поддомены
2. Определить границы контекстов
3. Определить отношения между контекстами
4. Спроектировать интеграцию между контекстами

### 2. Паттерны интеграции

- **Событийная архитектура** — контексты обмениваются событиями
- **REST API** — синхронное взаимодействие через HTTP
- **Общая база данных** (не рекомендуется, но иногда необходимо)
- **Асинхронные сообщения** — через брокеры сообщений (Kafka, RabbitMQ)

### 3. Управление консистентностью

- **Сильная согласованность** (в рамках одного контекста)
- **Итоговая согласованность** (между контекстами)
- **Саги (Sagas)** — для управления распределенными транзакциями

## Пример: Система электронной коммерции

### Контексты:

1. **Каталог товаров**
   - Управление товарами и категориями
   - Поиск и фильтрация

2. **Заказы**
   - Оформление заказа
   - Управление корзиной
   - История заказов

3. **Оплата**
   - Обработка платежей
   - Возвраты

4. **Доставка**
   - Расчет сроков доставки
   - Отслеживание заказов

5. **Учетные записи**
   - Аутентификация
   - Профили пользователей

## Заключение

Правильное выделение ограниченных контекстов — это искусство, которое приходит с опытом. Начните с более крупных контекстов и при необходимости разбивайте их на более мелкие. Помните, что границы контекстов могут и должны эволюционировать по мере развития системы.
