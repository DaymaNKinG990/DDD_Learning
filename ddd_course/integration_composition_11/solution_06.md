# Решение Упражнения: Проектирование Карты Контекстов и Интеграции для Системы "Онлайн-Университет"

## 1. Определение Ограниченных Контекстов

На основе предложенных функциональных блоков, определим следующие Ограниченные Контексты:

1.  **Контекст "Абитуриенты и Прием" (Admissions Context):**
    *   **Ответственность:** Управление всем жизненным циклом абитуриента, от подачи заявки до зачисления или отказа. Обработка заявок, проведение вступительных испытаний, принятие решений, формирование приказов о зачислении.
    *   **Ключевые понятия:** `Абитуриент`, `Заявка`, `Вступительное Испытание`, `Статус Заявки`, `Решение Приемной Комиссии`, `Приказ о Зачислении`.

2.  **Контекст "Управление Учебными Программами и Курсами" (Curriculum & Course Management Context):**
    *   **Ответственность:** Проектирование, создание и поддержка актуальности учебных программ и отдельных курсов. Определение структуры курсов, учебных материалов, критериев оценки.
    *   **Ключевые понятия:** `Учебная Программа`, `Курс`, `Модуль Курса`, `Учебный Материал`, `Компетенция`, `Каталог Курсов`.

3.  **Контекст "Обучение и Прогресс Студентов" (Student Learning & Progress Context):**
    *   **Ответственность:** Поддержка процесса обучения студентов. Запись на курсы, доступ к материалам, выполнение заданий, отслеживание успеваемости, взаимодействие в рамках курса.
    *   **Ключевые понятия:** `Студент` (в роли обучающегося), `Запись на Курс`, `Прогресс по Курсу`, `Задание`, `Оценка`, `Обсуждение Курса`.

4.  **Контекст "Кадровый Учет Преподавателей" (Faculty Staffing Context):**
    *   **Ответственность:** Управление данными о преподавателях, их контрактами, квалификациями, назначение на курсы (в смысле распределения нагрузки).
    *   **Ключевые понятия:** `Преподаватель`, `Контракт`, `Нагрузка`, `Квалификация`, `Расписание Преподавателя`.

5.  **Контекст "Финансовые Взаиморасчеты" (Financials Context):**
    *   **Ответственность:** Управление всеми финансовыми аспектами: оплата обучения, выставление счетов, обработка платежей, управление стипендиями.
    *   **Ключевые понятия:** `Счет на Оплату`, `Платеж`, `Тариф`, `Стипендия`, `Финансовое Обязательство Студента`.

6.  **Контекст "Аттестация и Выпуск" (Graduation & Certification Context):**
    *   **Ответственность:** Проверка выполнения студентами требований учебных программ, организация выпускных процедур, выдача документов об образовании.
    *   **Ключевые понятия:** `Выпускник`, `Соответствие Учебному Плану`, `Итоговая Аттестация`, `Сертификат`, `Диплом`, `Реестр Выпускников`.

7.  **Контекст "Пользовательские Аккаунты и Доступ" (User Accounts & Access Context):**
    *   **Ответственность:** Управление учетными записями всех пользователей системы (студенты, абитуриенты, преподаватели, администраторы), аутентификация, авторизация, управление ролями и правами доступа к различным частям системы.
    *   **Ключевые понятия:** `Пользователь`, `Учетная Запись`, `Роль`, `Право Доступа`, `Сессия`. (Этот контекст может быть более техническим, но важным для связности).

## 2. Карта Контекстов (Context Map)

```
                               +-----------------------------+
                               | Пользовательские Аккаунты   |
                               | и Доступ (User Accounts)    |
                               | (OHS, PL)                   |
                               +--------------^--------------+
                                              | (Customer-Supplier, ACL для некоторых)
                                              |
  +------------------------+     +------------+-------------+     +----------------------------+
  | Абитуриенты и Прием    |<----|                            |---->| Финансовые Взаиморасчеты |
  | (Admissions)           |     |                            |     | (Financials)             |
  |                        |     |                            |     |                          |
  | U: User Accounts (CS)  |     |                            |     | D: User Accounts (CS)    |
  | D: Student Learning(CS)|     | Обучение и Прогресс        |<----| U: Admissions (CS, Event)|
  | D: Financials (Event)  |     | Студентов (Student Learning)|     | U: Student Learning(Event)|
  +-----------^------------+     |                            |     +-------------^------------+
              | (CS, Event)      | U: User Accounts (CS)      |                  | (CS, Event)
              |                  | U: Curriculum & Courses(CF)|                  |
              |                  | U: Faculty Staffing (CS)   |                  |
              |                  | D: Graduation (CS, Event)  |                  |
              |                  +-------------^--------------+                  |
              |                                | (CS, Conformist)                |
              |                                |                                 |
+-------------+------------+     +-------------+--------------+     +------------+---------------+
| Управление Учебными      |<----|                              |---->| Аттестация и Выпуск        |
| Программами и Курсами    |     | Кадровый Учет Преподавателей |     | (Graduation & Certification)|
| (Curriculum & Courses)   |     | (Faculty Staffing)           |     |                            |
|                          |     |                              |     | D: Student Learning (CS)   |
| U: User Accounts (CS)    |     | U: User Accounts (CS)        |     | D: User Accounts (CS)      |
| D: Student Learning (CF) |     | D: Student Learning (CS)     |     +----------------------------+
+--------------------------+     +------------------------------+


Обозначения:
- OHS: Open Host Service
- PL: Published Language
- CS: Customer-Supplier
- CF: Conformist
- ACL: Anti-Corruption Layer
- Event: Асинхронная интеграция через события
- U: Upstream (Поставщик)
- D: Downstream (Клиент)
```

**Обоснование ключевых взаимосвязей:**

1.  **Admissions (D) --- CS, Event ---> Financials (U):**
    *   **Тип:** Клиент-Поставщик (Admissions - клиент, Financials - поставщик) и через События.
    *   **Обоснование:** Когда абитуриент зачислен (`Admissions`), этот контекст должен уведомить `Financials` о необходимости создать счет на оплату. `Admissions` является клиентом, так как ему нужна услуга от `Financials`. Уведомление может происходить асинхронно через событие (`StudentEnrolledEvent`), на которое подписывается `Financials`. `Financials` может также предоставлять API для `Admissions` для проверки финансового статуса абитуриента (например, оплатил ли он регистрационный взнос, если такой есть).

2.  **Student Learning (D) --- CF ---> Curriculum & Courses (U):**
    *   **Тип:** Конформист (Student Learning - клиент, Curriculum & Courses - поставщик).
    *   **Обоснование:** `Student Learning` использует структуру курсов, учебные материалы и описания, определенные в `Curriculum & Courses`. Модель курса в `Curriculum & Courses` (например, название, описание, список модулей) достаточно стабильна и авторитетна, поэтому `Student Learning` может просто принять ее "как есть" (конформист) для отображения студентам и организации процесса обучения. Это упрощает интеграцию.

3.  **User Accounts (U) --- CS ---> Все остальные контексты (D):**
    *   **Тип:** Клиент-Поставщик (User Accounts - поставщик). Некоторые клиенты могут использовать ACL, если модель пользователя в User Accounts слишком общая.
    *   **Обоснование:** `User Accounts` является центральным поставщиком информации о пользователях и их правах. Все остальные контексты являются клиентами, которым нужна эта информация для идентификации пользователей, аутентификации и авторизации действий. `User Accounts` предоставляет API (OHS+PL) для этих целей.

4.  **Student Learning (U) --- CS, Event ---> Graduation & Certification (D):**
    *   **Тип:** Клиент-Поставщик и через События.
    *   **Обоснование:** `Student Learning` отслеживает прогресс студента. Когда студент выполняет все требования курса/программы, `Student Learning` может опубликовать событие (`StudentCompletedProgramEvent`) или предоставить API, чтобы `Graduation & Certification` мог проверить готовность студента к выпуску и начать процесс аттестации.

## 3. Детализация Интеграции для Двух Взаимосвязей

### Взаимосвязь 1: Admissions (D) и Financials (U)

*   **Передаваемые данные/функциональность:**
    *   Из `Admissions` в `Financials`: Информация о зачисленном студенте для создания счета (ID студента, выбранная программа/курс, возможно, информация о скидках). Это может быть событие `StudentEnrolledEvent`.
    *   Из `Financials` в `Admissions` (опционально, по запросу): Статус оплаты регистрационного взноса или первого платежа абитуриентом.
*   **Технический способ интеграции:**
    *   **Событие `StudentEnrolledEvent` (асинхронно):** `Admissions` публикует событие в брокере сообщений (например, RabbitMQ, Kafka). `Financials` подписывается на это событие.
    *   **REST API (синхронно, для запросов):** `Financials` может предоставлять API endpoint (например, `GET /api/financials/student/{studentId}/status`) для проверки финансового статуса, который `Admissions` может вызывать при необходимости.
*   **ACL:** Не требуется, если `StudentEnrolledEvent` и API от `Financials` спроектированы с использованием `Published Language`, понятного обоим контекстам.
*   **Published Language (Пример для `StudentEnrolledEvent`):**
    ```json
    {
      "eventId": "unique-event-id",
      "eventType": "StudentEnrolledEvent",
      "timestamp": "2023-10-27T10:00:00Z",
      "payload": {
        "admissionId": "adm-123",
        "studentId": "user-xyz-789", // ID из User Accounts
        "programId": "prog-cs101",
        "enrollmentDate": "2023-09-01",
        "tuitionFeeAgreed": 5000.00, // Сумма к оплате за первый период
        "currency": "USD"
      }
    }
    ```

### Взаимосвязь 2: Student Learning (D) и Curriculum & Courses (U)

*   **Передаваемые данные/функциональность:**
    *   Из `Curriculum & Courses` в `Student Learning`: Информация о курсах (ID, название, описание, структура модулей, ссылки на материалы), каталоге курсов.
*   **Технический способ интеграции:**
    *   **REST API (синхронно):** `Curriculum & Courses` предоставляет API для получения каталога курсов (`GET /api/curriculum/courses`) и деталей конкретного курса (`GET /api/curriculum/courses/{courseId}`).
    *   `Student Learning` вызывает это API для отображения информации студентам и организации процесса обучения. Так как это "Конформист", `Student Learning` использует модели данных (DTO) от `Curriculum & Courses` напрямую.
*   **ACL:** Не используется в чистом виде (т.к. Конформист), но `Student Learning` может иметь тонкий клиентский слой для вызова API, который можно считать очень легковесным адаптером.
*   **Published Language (Пример DTO для `CourseDetails` от `Curriculum & Courses`):**
    ```json
    {
      "courseId": "crs-math101",
      "title": "Введение в высшую математику",
      "description": "Основные концепции математического анализа и линейной алгебры.",
      "instructorIds": ["prof-abc", "prof-def"],
      "modules": [
        {
          "moduleId": "mod-01",
          "title": "Пределы и непрерывность",
          "learningMaterials": [
            {"materialId": "mat-001", "type": "video", "title": "Лекция 1.1", "url": "/path/to/video1.mp4"},
            {"materialId": "mat-002", "type": "pdf", "title": "Задачи к семинару 1", "url": "/path/to/tasks1.pdf"}
          ]
        },
        {
          "moduleId": "mod-02",
          "title": "Производные",
          "learningMaterials": [ /* ... */ ]
        }
      ],
      "enrollmentStartDate": "2023-08-01",
      "enrollmentEndDate": "2023-08-31"
    }
    ```

## 4. Композиция UI (Краткое Обсуждение)

Для системы "Онлайн-Университет" с множеством различных функциональных блоков, которые могут развиваться независимо, подход **Микрофронтендов (Micro Frontends)** выглядит наиболее перспективным.

*   **Почему Микрофронтенды:**
    1.  **Независимость команд:** Каждая команда, ответственная за Ограниченный Контекст (например, `Admissions`, `Student Learning`, `Financials`), может разрабатывать, тестировать и развертывать свою часть UI независимо. Это ускоряет разработку и позволяет командам выбирать технологии, наиболее подходящие для их задач (хотя обычно стремятся к некоторой унификации для консистентности).
    2.  **Масштабируемость:** Легче масштабировать разработку, добавляя новые команды и функциональные блоки.
    3.  **Инкрементальные обновления:** Можно обновлять или заменять отдельные части UI, не затрагивая всю систему.
    4.  **Соответствие бэкенду:** Естественное соответствие архитектуре на основе Ограниченных Контекстов на бэкенде.

*   **Способ композиции:** Композиция на стороне клиента с использованием основного приложения-контейнера (shell application) и веб-компонентов или фреймворков, поддерживающих динамическую загрузку модулей (например, Module Federation в Webpack).

*   **Сложности и как их решать:**
    *   **Консистентный UX/UI:** Использование общей библиотеки UI-компонентов (design system), общих CSS-гайдов и правил.
    *   **Маршрутизация:** Централизованная или координируемая маршрутизация в приложении-контейнере.
    *   **Коммуникация между микрофронтендами:** Через кастомные события браузера, общий event bus или через состояние, управляемое приложением-контейнером.
    *   **Управление общими зависимостями:** Использование инструментов типа Webpack Module Federation для эффективного разделения и загрузки зависимостей.

Монолитный фронтенд быстро стал бы узким местом. Простые гиперссылки между полностью отдельными приложениями не обеспечили бы должного уровня интеграции и пользовательского опыта для такой сложной платформы.
